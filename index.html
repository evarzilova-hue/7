<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ—Ü–∏–∞–ª–µ–Ω –ö–æ–º–ø–∞—Å: –†–æ–±–∏–Ω–∑–æ–Ω –ö—Ä—É–∑–æ –∏ AI</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#22c55e">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f8f8; }
        .card { background-color: white; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .btn-primary {
            background-color: #22c55e;
            color: white;
            transition: transform 0.1s;
        }
        .btn-primary:hover { background-color: #16a34a; }
        .btn-primary:active { transform: scale(0.98); }
        .mission-overlay {
            backdrop-filter: blur(8px);
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 50;
        }
        .modal {
            z-index: 60;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <!-- –ê—É–¥–∏–æ –µ–ª–µ–º–µ–Ω—Ç –∑–∞ –∞–ª–∞—Ä–º–∞—Ç–∞ -->
    <audio id="alarm-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-analog-watch-alarm-576.mp3" preload="auto"></audio>

    <div id="main-app" class="w-full max-w-lg">
        
        <!-- 1. –î–∏–≥–∏—Ç–∞–ª–µ–Ω –Ω–∞—Ä—ä—á–Ω–∏–∫ –Ω–∞ –ö—Ä—É–∑–æ (–†–æ—Ç–∏—Ä–∞—â–∏ —Å–µ –º–æ—Ç–æ—Ç–∞) -->
        <div class="card p-4 mb-6 text-center bg-gray-100 border-l-4 border-emerald-500">
            <p class="text-xs text-gray-600 font-semibold mb-1 uppercase">–î–∏–≥–∏—Ç–∞–ª–µ–Ω –Ω–∞—Ä—ä—á–Ω–∏–∫ –Ω–∞ –ö—Ä—É–∑–æ</p>
            <p id="motto" class="text-sm md:text-md font-bold text-gray-800 italic transition duration-500 ease-in-out"></p>
        </div>

        <!-- 2. –û—Å–Ω–æ–≤–µ–Ω –ü–∞–Ω–µ–ª: –¢–∞–π–º–µ—Ä –∏ –•–æ—Ä–º–æ–Ω–∏ -->
        <div class="card p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4 text-emerald-700">–°–æ—Ü–∏–∞–ª–µ–Ω –ö–æ–º–ø–∞—Å</h1>

            <!-- –•–æ—Ä–º–æ–Ω–∞–ª–µ–Ω –±–∞–ª–∞–Ω—Å -->
            <div class="flex justify-between items-center mb-4 p-3 bg-red-50 rounded-lg shadow-inner">
                <div class="text-center w-1/2">
                    <p class="text-xs font-semibold text-gray-600">–ö–æ—Ä—Ç–∏–∑–æ–ª (–°—Ç—Ä–µ—Å)</p>
                    <p id="cortisol-level" class="text-xl font-extrabold text-red-600">0</p>
                </div>
                <div class="text-center w-1/2 border-l border-gray-200">
                    <p class="text-xs font-semibold text-gray-600">–ï–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ (–©–∞—Å—Ç–∏–µ)</p>
                    <p id="endorphin-level" class="text-xl font-extrabold text-emerald-600">0</p>
                </div>
            </div>

            <!-- –¢–∞–π–º–µ—Ä –∏ –æ–±—â–æ –≤—Ä–µ–º–µ -->
            <div class="text-center mb-4">
                <p class="text-xs font-semibold text-gray-500 mb-1">–í—Ä–µ–º–µ –¥–æ "–ö—Ä—É–∑–æ –ê–ª–∞—Ä–º" (–ü—Ä–∞–≥: <span id="alarm-threshold">38</span> –º–∏–Ω.)</p>
                <div id="countdown-timer" class="text-5xl font-extrabold text-gray-900 mb-2">00:00</div>
                <p class="text-xs font-semibold text-gray-500">–û–±—â–æ –≤—Ä–µ–º–µ –ø—Ä–µ–¥ –µ–∫—Ä–∞–Ω–∞: <span id="total-time" class="font-bold">0 –º–∏–Ω—É—Ç–∏</span></p>
            </div>

            <!-- –°—ä–æ–±—â–µ–Ω–∏—è -->
            <div id="message-area" class="h-8 text-center text-sm font-medium text-gray-700"></div>
        </div>
        
        <!-- 3. –ë—É—Ç–æ–Ω–∏ –∑–∞ –ú–∏—Å–∏–∏ (–í–∏–¥–∏–º–∏ —Å–∞–º–æ —Å–ª–µ–¥ –∞–ª–∞—Ä–º–∞) -->
        <div id="mission-action-panel" class="hidden flex flex-col space-y-3">
            <button id="start-mission-btn" class="btn-primary p-3 rounded-xl font-semibold shadow-lg">
                –ò–ó–ü–™–õ–ù–ò –§–í–° –ú–ò–°–ò–Ø (–ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ)
            </button>
            <button id="refuse-mission-btn" class="bg-red-500 text-white p-2 rounded-xl font-semibold hover:bg-red-600 transition">
                –û–¢–ö–ê–ó (–ê–∫—Ç–∏–≤–∏—Ä–∞–π –ï—Ç–∏—á–µ–Ω –§–∏–ª—Ç—ä—Ä)
            </button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ò -->

    <!-- –ú–æ–¥–∞–ª: –ö—Ä—É–∑–æ –ê–ª–∞—Ä–º / –ú–∏—Å–∏—è -->
    <div id="mission-modal" class="mission-overlay fixed inset-0 hidden items-center justify-center p-4">
        <div class="modal card p-6 w-full max-w-md text-center">
            <h2 class="text-3xl font-bold text-red-600 mb-3">üö® –ö–†–£–ó–û –ê–õ–ê–†–ú üö®</h2>
            <p class="mb-4 text-lg font-semibold text-gray-700">–î–æ—Å—Ç–∏–≥–Ω–∞—Ç –µ –ª–∏–º–∏—Ç—ä—Ç –æ—Ç <span id="modal-threshold">38</span> –º–∏–Ω—É—Ç–∏. –í—Ä–µ–º–µ –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç!</p>
            
            <div id="mission-content" class="p-4 bg-emerald-50 rounded-lg mb-4 hidden">
                <p class="text-xs font-semibold text-emerald-700 mb-1">–¢–≤–æ—è—Ç–∞ –§–í–° –ú–∏—Å–∏—è:</p>
                <p id="mission-title" class="text-xl font-bold text-emerald-800 mb-2"></p>
                <p id="mission-instruction" class="text-sm text-gray-600 italic"></p>
                <a id="mission-video-link" href="#" target="_blank" class="text-sm text-blue-500 hover:underline mt-2 inline-block">–í–∏–∂ –∞–Ω–∏–º–∞—Ü–∏—è (–∞–∫–æ –∏–º–∞)</a>
            </div>

            <button id="generate-mission-btn" class="btn-primary p-3 rounded-xl font-semibold w-full shadow-lg">–ì–ï–ù–ï–†–ò–†–ê–ô –ú–ò–°–ò–Ø</button>
            <button id="confirm-mission-btn" class="btn-primary p-3 rounded-xl font-semibold w-full mt-2 hidden">–ü–û–¢–í–™–†–î–ò –ò–ó–ü–™–õ–ù–ï–ù–ò–ï–¢–û</button>
            <button id="refuse-modal-btn" class="text-sm text-gray-500 hover:text-red-600 mt-4 transition">–û–¢–ö–ê–ó (–ï—Ç–∏—á–µ–Ω –§–∏–ª—Ç—ä—Ä)</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª: –ï—Ç–∏—á–µ–Ω –§–∏–ª—Ç—ä—Ä -->
    <div id="ethics-modal" class="mission-overlay fixed inset-0 hidden items-center justify-center p-4">
        <div class="modal card p-6 w-full max-w-md">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">–ï—Ç–∏—á–µ–Ω –§–∏–ª—Ç—ä—Ä: –ö–∞–∑—É—Å –ê–¥–∞–º –†–µ–π–Ω</h2>
            <p class="text-sm text-red-600 mb-4 font-semibold">–¢—Ä—è–±–≤–∞ –¥–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—à –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–µ–¥–∏ –¥–∞ —Å–µ –≤—ä—Ä–Ω–µ—à –∫—ä–º —Ä–∞–±–æ—Ç–∞.</p>
            
            <div id="ethics-questions" class="space-y-4">
                <!-- –í—ä–ø—Ä–æ—Å–∏—Ç–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç —Ç—É–∫ –æ—Ç JS -->
            </div>

            <button id="submit-ethics-btn" class="btn-primary p-3 rounded-xl font-semibold w-full mt-6 shadow-lg">–ò–ó–ü–†–ê–¢–ò –û–¢–ì–û–í–û–†–ò–¢–ï</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª: –ö—Ä–∏–∑–∏—Å–Ω–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∏ -->
    <div id="crisis-modal" class="mission-overlay fixed inset-0 hidden items-center justify-center p-4">
        <div class="modal card p-6 w-full max-w-md text-center border-t-8 border-red-500">
            <h2 class="text-3xl font-bold text-red-600 mb-3">üÜò –¢–™–†–°–ò –ü–û–ú–û–© üÜò</h2>
            <p class="mb-4 text-lg font-semibold text-gray-700">–û—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ —Ç–∏ –ø–æ–∫–∞–∑–≤–∞—Ç –≤–∏—Å–æ–∫ —Ä–∏—Å–∫ –æ—Ç –¥–∏–≥–∏—Ç–∞–ª–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç. –ú–æ–ª—è, —Å–≤—ä—Ä–∂–∏ —Å–µ —Å –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏.</p>
            
            <div class="p-4 bg-red-50 rounded-lg mb-4 space-y-3">
                <div class="text-left">
                    <p class="text-xs font-semibold text-gray-600">–ù–∞—Ü–∏–æ–Ω–∞–ª–Ω–∞ –ª–∏–Ω–∏—è –∑–∞ –ø–æ–¥–∫—Ä–µ–ø–∞</p>
                    <p class="text-xl font-bold text-gray-800">‚òéÔ∏è 116 111</p>
                </div>
                <div class="text-left border-t pt-3">
                    <p class="text-xs font-semibold text-gray-600">–ë—ä–ª–≥–∞—Ä—Å–∫–∏ –ß–µ—Ä–≤–µ–Ω –ö—Ä—ä—Å—Ç (–ë–ß–ö)</p>
                    <p class="text-xl font-bold text-gray-800">‚òéÔ∏è 0800-20-202</p>
                </div>
            </div>

            <button id="close-crisis-btn" class="btn-primary p-3 rounded-xl font-semibold w-full mt-4 shadow-lg">–†–ê–ó–ë–†–ê–ù–û. –í–™–†–ù–ò –ú–ï –û–ë–†–ê–¢–ù–û.</button>
        </div>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ù–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–ï–¢–û (–ò–∑–≤–ª–µ—á–µ–Ω–∏ –¥–∞–Ω–Ω–∏) ---

        const ALARM_THRESHOLD_MINUTES = 38; // –ü—Ä–∞–≥ –Ω–∞ "–ö—Ä—É–∑–æ –∞–ª–∞—Ä–º" –æ—Ç –°–µ–∫—Ü–∏—è II
        const CORTISOL_DECREASE_MISSION = -35; // –ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –∫–æ—Ä—Ç–∏–∑–æ–ª –ø—Ä–∏ –º–∏—Å–∏—è
        const ENDORPHIN_INCREASE_MISSION = +3;   // –ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ –µ–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ –ø—Ä–∏ –º–∏—Å–∏—è
        
        // –•–æ—Ä–º–æ–Ω–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–∞ (–Ω–∞ –≤—Å–µ–∫–∏ 5 –º–∏–Ω—É—Ç–∏)
        const CORTISOL_INCREASE_WORK = 5;
        const ENDORPHIN_DECREASE_WORK = 5;

        // –ú–æ—Ç–æ—Ç–∞ (–î–∏–≥–∏—Ç–∞–ª–µ–Ω –Ω–∞—Ä—ä—á–Ω–∏–∫ –Ω–∞ –ö—Ä—É–∑–æ) –æ—Ç –°–µ–∫—Ü–∏—è I
        const MOTTOS = [
            "–°–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª –∏ —Ä–∏—Ç—ä–º –ø–æ–±–µ–∂–¥–∞–≤–∞ –º—ä—Ä–∑–µ–ª–∞.",
            "–ñ–∏–≤–æ—Ç—ä—Ç –µ —Ä–µ–∞–ª–Ω–æ—Å—Ç, –∞ –Ω–µ —Å–∏–º—É–ª–∞—Ü–∏—è.",
            "–ò—Å—Ç–∏–Ω—Å–∫–æ—Ç–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ –µ —á–æ–≤–µ—à–∫–∞—Ç–∞ –≤—Ä—ä–∑–∫–∞.",
            "–¢—Ä—É–¥—ä—Ç –∫—Ä–∞—Å–∏ —á–æ–≤–µ–∫–∞.",
            "–ù–∞–¥–µ–∂–¥–∞—Ç–∞ –≤–æ–¥–∏ –¥–æ—Ä–∏ –≤ –ø—É—Å—Ç–æ—à—Ç–∞."
        ];

        // –§–í–° –ú–∏—Å–∏–∏ –æ—Ç –°–µ–∫—Ü–∏—è III
        const MISSIONS = [
            { title: "–ö–µ–Ω–≥—É—Ä—Å–∫–∏ –ø–æ–¥—Å–∫–æ—Ü–∏", instruction: "–ù–∞–ø—Ä–∞–≤–∏ 10 –∫–µ–Ω–≥—É—Ä—Å–∫–∏ –ø–æ–¥—Å–∫–æ–∫–∞. –¢–æ–≤–∞ —Å–∞ –ø–æ–¥—Å–∫–æ—Ü–∏, –∫—ä–¥–µ—Ç–æ –∫–æ–ª–µ–Ω–µ—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–æ–∫–æ—Å–Ω–∞—Ç –≥—Ä—ä–¥–Ω–∏—è –∫–æ—à.", link: "https://www.youtube.com/results?search_query=–∫–µ–Ω–≥—É—Ä—Å–∫–∏+–ø–æ–¥—Å–∫–æ—Ü–∏+—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" },
            { title: "–î–∂—ä–º–ø–∏–Ω–≥ –¥–∂–∞–∫—Å", instruction: "–ù–∞–ø—Ä–∞–≤–∏ 15 –¥–∂—ä–º–ø–∏–Ω–≥ –¥–∂–∞–∫—Å. –¢–æ–≤–∞ —Å–∞ –ø–æ–¥—Å–∫–æ—Ü–∏, –∫—ä–¥–µ—Ç–æ –ø—Ä–∏ —à–∏—Ä–æ–∫ —Ä–∞–∑–∫—Ä–∞—á —Ä—ä—Ü–µ—Ç–µ —Ç–∏ —Å–∞ –Ω–∞–¥ –≥–ª–∞–≤–∞—Ç–∞, –∞ –ø—Ä–∏ —Å—ä–±—Ä–∞–Ω–∏ –∫—Ä–∞–∫–∞, —Å–∞ –∑–∞–ª–µ–ø–µ–Ω–∏ –¥–æ —Ç—è–ª–æ—Ç–æ.", link: "https://www.youtube.com/results?search_query=–¥–∂—ä–º–ø–∏–Ω–≥+–¥–∂–∞–∫—Å+—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" },
            { title: "–ö–æ—Ä–µ–º–Ω–∏ –ø—Ä–µ—Å–∏", instruction: "–ù–∞–ø—Ä–∞–≤–∏ 10 –∫–æ—Ä–µ–º–Ω–∏ –ø—Ä–µ—Å–∏. –¢–æ–≤–∞ –µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∑–∞ —Å—Ç—è–≥–∞–Ω–µ –Ω–∞ –∫–æ—Ä–µ–º–Ω–∏—Ç–µ –º—É—Å–∫—É–ª–∏, –∫—ä–¥–µ—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–≤–¥–∏–≥–Ω–µ—à —Ç–æ—Ä—Å–∞ —Å–∏ –±–µ–∑ –∑–∞ —Å–∏ –ø–æ–º–∞–≥–∞—à —Å –∫—Ä–∞–π–Ω–∏—Ü–∏.", link: "https://www.youtube.com/results?search_query=–∫–æ—Ä–µ–º–Ω–∏+–ø—Ä–µ—Å–∏+—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" },
            { title: "–ë—ä—Ä–ø–∏—Ç–∞", instruction: "–ù–∞–ø—Ä–∞–≤–∏ 10 –±—ä—Ä–ø–∏—Ç–∞. –¢–æ–≤–∞ –µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ–µ—Ç–æ –æ—Ç –∫–ª–µ–∫–Ω–∞–ª–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ —Å–∫–∞—á–∞—à –∏ —Å–µ –ø—Ä–∏–∑–µ–º—è–≤–∞—à –æ—Ç–Ω–æ–≤–æ –≤ –∫–ª–µ–∫ —Å–ª–µ–¥ –∫–æ–µ—Ç–æ –∏–∑–ø—ä–ª–Ω—è–≤–∞—à –ª–∏—Ü–µ–≤–∞ —É–ø–æ—Ä–∞ –∏–ª–∏ –ø–ª–∞–Ω–∫.", link: "https://www.youtube.com/results?search_query=–±—ä—Ä–ø–∏—Ç–∞+—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" }
        ];

        // –ï—Ç–∏—á–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏ –æ—Ç –°–µ–∫—Ü–∏—è IV
        const ETHICS_QUESTIONS = [
            "–ò–º–∞ –ª–∏ —Å–º–∏—Å—ä–ª –¥–∞ –∑–∞–º–µ–Ω—è—à –∏—Å—Ç–∏–Ω—Å–∫–æ—Ç–æ —Å –∏–∑–º–∏—Å–ª–∏—Ü–∞?",
            "–ü—Ä–µ–Ω–µ–±—Ä–µ–≥–≤–∞—Ç–µ –ª–∏ —Å—ä–Ω—è, —Ö—Ä–∞–Ω–µ–Ω–µ—Ç–æ, —Ö–∏–≥–∏–µ–Ω–∞—Ç–∞ –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—Ç–∞ —Å–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç –∑–∞—Ä–∞–¥–∏ –ø—Ä–µ–∫–æ–º–µ—Ä–Ω–æ –≤—Ä–µ–º–µ –ø—Ä–µ–¥ –µ–∫—Ä–∞–Ω–∞?",
            "–ò–∑–ø–æ–ª–∑–≤–∞—Ç–µ –ª–∏ –¥–∏–≥–∏—Ç–∞–ª–Ω–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏, –∑–∞ –¥–∞ –∏–∑–±—è–≥–∞—Ç–µ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏ –∏–ª–∏ —Ä–µ–∞–ª–Ω–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏?"
        ];

        // --- –ì–õ–û–ë–ê–õ–ù–ò –ü–†–û–ú–ï–ù–õ–ò–í–ò –ò –°–™–°–¢–û–Ø–ù–ò–ï ---

        let cortisolLevel = 0;
        let endorphinLevel = 0;
        let alarmTimeSeconds = 0; // –í—Ä–µ–º–µ, –æ—Ç—á–µ—Ç–µ–Ω–æ –æ—Ç —Ç–∞–π–º–µ—Ä–∞ –∑–∞ –∞–ª–∞—Ä–º–∞—Ç–∞
        let totalTimeSeconds = 0; // –û–±—â–æ –≤—Ä–µ–º–µ –ø—Ä–µ–¥ –µ–∫—Ä–∞–Ω–∞
        let timerInterval;
        let isAlarmActive = false;
        let isMissionCompleted = false; // –§–ª–∞–≥ –¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –º–∏—Å–∏—è –µ –∏–∑–ø—ä–ª–Ω–µ–Ω–∞

        const DOM = {
            motto: document.getElementById('motto'),
            cortisolLevel: document.getElementById('cortisol-level'),
            endorphinLevel: document.getElementById('endorphin-level'),
            countdownTimer: document.getElementById('countdown-timer'),
            totalTime: document.getElementById('total-time'),
            messageArea: document.getElementById('message-area'),
            missionActionPanel: document.getElementById('mission-action-panel'),
            missionModal: document.getElementById('mission-modal'),
            ethicsModal: document.getElementById('ethics-modal'),
            crisisModal: document.getElementById('crisis-modal'),
            alarmSound: document.getElementById('alarm-sound'),
            modalThreshold: document.getElementById('modal-threshold'),
        };

        // --- –§–£–ù–ö–¶–ò–ò –ó–ê UI & –°–™–°–¢–û–Ø–ù–ò–ï ---

        function updateHormoneUI() {
            DOM.cortisolLevel.textContent = cortisolLevel;
            DOM.endorphinLevel.textContent = endorphinLevel;
            // –î–∏–Ω–∞–º–∏—á–Ω–æ –æ—Ü–≤–µ—Ç—è–≤–∞–Ω–µ
            DOM.cortisolLevel.classList.toggle('text-red-900', cortisolLevel >= 20);
            DOM.endorphinLevel.classList.toggle('text-green-900', endorphinLevel >= 15);
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateTimerUI() {
            DOM.countdownTimer.textContent = formatTime(alarmTimeSeconds);
            DOM.totalTime.textContent = `${Math.floor(totalTimeSeconds / 60)} –º–∏–Ω—É—Ç–∏`;
        }

        function rotateMottos() {
            let index = 0;
            DOM.motto.textContent = MOTTOS[index];
            setInterval(() => {
                index = (index + 1) % MOTTOS.length;
                DOM.motto.textContent = MOTTOS[index];
            }, 8000); // –°–º–µ–Ω—è –º–æ—Ç–æ—Ç–æ –Ω–∞ –≤—Å–µ–∫–∏ 8 —Å–µ–∫—É–Ω–¥–∏
        }

        function showAlertMessage(message, color = 'text-green-600') {
            DOM.messageArea.textContent = message;
            DOM.messageArea.className = `h-8 text-center text-sm font-medium ${color}`;
            setTimeout(() => {
                DOM.messageArea.textContent = '';
                DOM.messageArea.className = 'h-8 text-center text-sm font-medium text-gray-700';
            }, 5000);
        }

        // --- –õ–û–ì–ò–ö–ê –ù–ê –¢–ê–ô–ú–ï–†–ê –ò –•–û–†–ú–û–ù–ò–¢–ï ---

        function startTimer() {
            if (timerInterval) return; // –í–µ—á–µ –µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω

            DOM.modalThreshold.textContent = ALARM_THRESHOLD_MINUTES;

            timerInterval = setInterval(() => {
                // –û–±—â–æ –≤—Ä–µ–º–µ (—Ä–∞–±–æ—Ç–∏ –≤–∏–Ω–∞–≥–∏)
                totalTimeSeconds++; 

                if (isAlarmActive) return; // –ê–∫–æ –∞–ª–∞—Ä–º–∞—Ç–∞ –µ –∞–∫—Ç–∏–≤–Ω–∞, —Å–ø–∏—Ä–∞–º–µ –æ—Ç–±—Ä–æ—è–≤–∞–Ω–µ—Ç–æ –∑–∞ –ø—Ä–∞–≥–∞

                // –í—Ä–µ–º–µ –∑–∞ –∞–ª–∞—Ä–º–∞—Ç–∞ (—Ä–∞–±–æ—Ç–∏ –¥–æ –¥–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≥–∞)
                alarmTimeSeconds++;
                updateTimerUI();

                // –•–æ—Ä–º–æ–Ω–∞–ª–Ω–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –≤—Å–µ–∫–∏ 5 –º–∏–Ω—É—Ç–∏ (300 —Å–µ–∫—É–Ω–¥–∏)
                if (alarmTimeSeconds % 300 === 0) {
                    cortisolLevel += CORTISOL_INCREASE_WORK;
                    endorphinLevel -= ENDORPHIN_DECREASE_WORK;
                    showAlertMessage(`üìà –ö–æ—Ä—Ç–∏–∑–æ–ª +${CORTISOL_INCREASE_WORK}, –ï–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ -${ENDORPHIN_DECREASE_WORK}. –í–∑–µ–º–∏ —Å–∏ –ø–æ—á–∏–≤–∫–∞!`, 'text-red-500');
                    updateHormoneUI();
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –¥–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≥–∞
                if (alarmTimeSeconds >= ALARM_THRESHOLD_MINUTES * 60) {
                    triggerAlarm();
                }
            }, 1000);
        }
        
        // --- –õ–û–ì–ò–ö–ê –ù–ê –ê–õ–ê–†–ú–ê–¢–ê ---

        function triggerAlarm() {
            if (isAlarmActive) return;
            isAlarmActive = true;
            DOM.alarmSound.play();
            DOM.missionModal.classList.remove('hidden');
            DOM.missionModal.classList.add('flex');
            
            // –°–∫—Ä–∏–≤–∞–º–µ –æ—Å–Ω–æ–≤–Ω–∏—è –ø–∞–Ω–µ–ª, –¥–æ–∫–∞—Ç–æ –º–∏—Å–∏—è—Ç–∞ –Ω–µ –±—ä–¥–µ —Ä–µ—à–µ–Ω–∞
            // DOM.mainApp.classList.add('hidden'); 
        }

        function resolveAlarm() {
            DOM.alarmSound.pause();
            DOM.alarmSound.currentTime = 0;
            isAlarmActive = false;
            // DOM.mainApp.classList.remove('hidden'); 

            // –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –º–æ–¥–∞–ª–∞ –∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–∏—è –ø–∞–Ω–µ–ª
            DOM.missionModal.classList.add('hidden');
            DOM.missionModal.classList.remove('flex');
            
            // –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–π–º–µ—Ä–∞ –∑–∞ –∞–ª–∞—Ä–º–∞—Ç–∞
            alarmTimeSeconds = 0;
            updateTimerUI();

            // –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ –∑–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –∏ –º–∏—Å–∏—è—Ç–∞
            document.getElementById('mission-content').classList.add('hidden');
            document.getElementById('confirm-mission-btn').classList.add('hidden');
            document.getElementById('generate-mission-btn').classList.remove('hidden');
        }

        // --- –õ–û–ì–ò–ö–ê –ù–ê –ú–ò–°–ò–ò–¢–ï –§–í–° ---

        document.getElementById('generate-mission-btn').addEventListener('click', generateMission);

        function generateMission() {
            const randomIndex = Math.floor(Math.random() * MISSIONS.length);
            const mission = MISSIONS[randomIndex];

            document.getElementById('mission-title').textContent = mission.title;
            document.getElementById('mission-instruction').textContent = mission.instruction;
            document.getElementById('mission-video-link').href = mission.link;
            
            document.getElementById('mission-content').classList.remove('hidden');
            document.getElementById('generate-mission-btn').classList.add('hidden');
            document.getElementById('confirm-mission-btn').classList.remove('hidden');
        }

        document.getElementById('confirm-mission-btn').addEventListener('click', confirmMission);

        function confirmMission() {
            cortisolLevel += CORTISOL_DECREASE_MISSION; // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª–Ω–æ —á–∏—Å–ª–æ, —Ç.–µ. –Ω–∞–º–∞–ª—è–≤–∞
            endorphinLevel += ENDORPHIN_INCREASE_MISSION; // –ü–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–æ —á–∏—Å–ª–æ, —Ç.–µ. —É–≤–µ–ª–∏—á–∞–≤–∞
            
            updateHormoneUI();
            isMissionCompleted = true; // –ó–∞ –¥–∞ –º–æ–∂–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏
            showAlertMessage(`‚úÖ –ú–∏—Å–∏—è –∏–∑–ø—ä–ª–Ω–µ–Ω–∞! –ö–æ—Ä—Ç–∏–∑–æ–ª ${CORTISOL_DECREASE_MISSION}, –ï–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ +${ENDORPHIN_INCREASE_MISSION}`, 'text-emerald-600');
            resolveAlarm();
        }

        // --- –õ–û–ì–ò–ö–ê –ù–ê –ï–¢–ò–ß–ù–ò–Ø –§–ò–õ–¢–™–† ---

        // –ê–∫—Ç–∏–≤–∏—Ä–∞ —Å–µ –ø—Ä–∏ –æ—Ç–∫–∞–∑ –æ—Ç –º–∏—Å–∏—è –≤ –º–æ–¥–∞–ª–∞
        document.getElementById('refuse-modal-btn').addEventListener('click', () => {
            DOM.missionModal.classList.add('hidden');
            DOM.missionModal.classList.remove('flex');
            showEthicsModal();
        });

        // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ –≤ –º–æ–¥–∞–ª–∞
        function showEthicsModal() {
            const container = document.getElementById('ethics-questions');
            container.innerHTML = '';
            
            ETHICS_QUESTIONS.forEach((question, index) => {
                const qHtml = `
                    <div class="p-3 border rounded-lg bg-white shadow-sm">
                        <p class="text-sm font-medium text-gray-700 mb-2">${index + 1}. ${question}</p>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="q${index}" value="yes" class="form-radio text-red-600 focus:ring-red-500" required>
                                <span class="ml-2 text-red-600 font-semibold">–î–∞</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="q${index}" value="no" class="form-radio text-emerald-600 focus:ring-emerald-500" checked>
                                <span class="ml-2 text-emerald-600 font-semibold">–ù–µ</span>
                            </label>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', qHtml);
            });
            
            DOM.ethicsModal.classList.remove('hidden');
            DOM.ethicsModal.classList.add('flex');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ
        document.getElementById('submit-ethics-btn').addEventListener('click', () => {
            let yesCount = 0;
            let allAnswered = true;

            ETHICS_QUESTIONS.forEach((_, index) => {
                const radios = document.getElementsByName(`q${index}`);
                let answered = false;
                for (const radio of radios) {
                    if (radio.checked) {
                        answered = true;
                        if (radio.value === 'yes') {
                            yesCount++;
                        }
                        break;
                    }
                }
                if (!answered) {
                    allAnswered = false;
                }
            });

            if (!allAnswered) {
                showAlertMessage("–ú–æ–ª—è, –æ—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ –≤—Å–∏—á–∫–∏ –≤—ä–ø—Ä–æ—Å–∏.", 'text-red-500');
                return;
            }

            DOM.ethicsModal.classList.add('hidden');
            DOM.ethicsModal.classList.remove('flex');

            if (yesCount >= 2) {
                // –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –ö—Ä–∏–∑–∏—Å–Ω–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∏
                showCrisisModal();
            } else {
                // –ù–∏—Å–∫–æ—Ä–∏—Å–∫–æ–≤, –≤—Ä—ä—â–∞–Ω–µ –∫—ä–º –º–∏—Å–∏—è—Ç–∞
                showAlertMessage("üß† –ï—Ç–∏—á–µ–Ω –∞–Ω–∞–ª–∏–∑: –î–æ–±—Ä–µ. –ü—Ä–æ–¥—ä–ª–∂–∏ —Å –º–∏—Å–∏—è—Ç–∞, –∑–∞ –¥–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–∏—à –±–∞–ª–∞–Ω—Å–∞.", 'text-emerald-600');
                // –í—Ä—ä—â–∞–Ω–µ –∫—ä–º –ú–æ–¥–∞–ª–∞ –∑–∞ –ú–∏—Å–∏—è, –∑–∞ –¥–∞ –º–æ–∂–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –¥–∞ —è –∏–∑–ø—ä–ª–Ω–∏
                DOM.missionModal.classList.remove('hidden');
                DOM.missionModal.classList.add('flex');
                
                // –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ –∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ
                document.getElementById('mission-content').classList.add('hidden');
                document.getElementById('confirm-mission-btn').classList.add('hidden');
                document.getElementById('generate-mission-btn').classList.remove('hidden');
            }
        });

        // --- –õ–û–ì–ò–ö–ê –ù–ê –ö–†–ò–ó–ò–°–ù–ò–¢–ï –ö–û–ù–¢–ê–ö–¢–ò ---

        function showCrisisModal() {
            DOM.crisisModal.classList.remove('hidden');
            DOM.crisisModal.classList.add('flex');
            // –ü—Ä–∏–∫–∞–∑–∫–∞: –ö—Ä–∏–∑–∏—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Å–∞ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –º—è—Ä–∫–∞. –¢—Ä—è–±–≤–∞ –¥–∞ –≥–∏ –∑–∞—Ç–≤–æ—Ä–∏, –∑–∞ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏.
        }
        
        document.getElementById('close-crisis-btn').addEventListener('click', () => {
            DOM.crisisModal.classList.add('hidden');
            DOM.crisisModal.classList.remove('flex');
            
            showAlertMessage("–ú–æ–ª—è, –∏–∑–ø—ä–ª–Ω–∏ –§–í–° –ú–∏—Å–∏—è—Ç–∞, –∑–∞ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—à.", 'text-red-500');

            // –í—Ä—ä—â–∞–Ω–µ –∫—ä–º –ú–æ–¥–∞–ª–∞ –∑–∞ –ú–∏—Å–∏—è (—Å–ª–µ–¥ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫—Ä–∏–∑–∏—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∏)
            DOM.missionModal.classList.remove('hidden');
            DOM.missionModal.classList.add('flex');

            // –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –º–∏—Å–∏—è—Ç–∞
            document.getElementById('mission-content').classList.add('hidden');
            document.getElementById('confirm-mission-btn').classList.add('hidden');
            document.getElementById('generate-mission-btn').classList.remove('hidden');
        });

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        
        // –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–π–º–µ—Ä–∞ –≤—ä–≤ —Ñ–æ–Ω–æ–≤ —Ä–µ–∂–∏–º (window focus/blur)
        let backgroundTimeStart = 0;
        let backgroundTimeAccumulated = 0;

        // –¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä–∞ –≤—Ä–µ–º–µ—Ç–æ, –ø—Ä–µ–∫–∞—Ä–∞–Ω–æ, –¥–æ–∫–∞—Ç–æ –ø—Ä–æ–∑–æ—Ä–µ—Ü—ä—Ç –µ –±–∏–ª –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
        function applyBackgroundTime() {
            if (backgroundTimeStart > 0) {
                const elapsed = Math.floor((Date.now() - backgroundTimeStart) / 1000);
                
                // –í—Ä–µ–º–µ—Ç–æ –Ω–∞ –∞–ª–∞—Ä–º–∞—Ç–∞ —Å–µ –Ω–∞–≤–∞–∫—Å–≤–∞ —Å–∞–º–æ –∞–∫–æ –∞–ª–∞—Ä–º–∞—Ç–∞ –Ω–µ –µ –∞–∫—Ç–∏–≤–Ω–∞
                if (!isAlarmActive) {
                    alarmTimeSeconds += elapsed;
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –¥–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≥–∞ –≤–µ–¥–Ω–∞–≥–∞
                    if (alarmTimeSeconds >= ALARM_THRESHOLD_MINUTES * 60) {
                        alarmTimeSeconds = ALARM_THRESHOLD_MINUTES * 60; // –ö–∞–ø–≤–∞–º–µ –≥–æ –Ω–∞ –ø—Ä–∞–≥–∞
                        updateTimerUI();
                        triggerAlarm();
                    }
                }
                
                // –û–±—â–æ—Ç–æ –≤—Ä–µ–º–µ –≤–∏–Ω–∞–≥–∏ —Å–µ –Ω–∞—Ç—Ä—É–ø–≤–∞
                totalTimeSeconds += elapsed;
                
                // –ü—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ —Ö–æ—Ä–º–æ–Ω–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏ –∑–∞ —Ñ–æ–Ω–æ–≤–æ—Ç–æ –≤—Ä–µ–º–µ
                const fiveMinuteIntervalsPassed = Math.floor((totalTimeSeconds) / 300) - 
                                                 Math.floor((totalTimeSeconds - elapsed) / 300);
                
                if (fiveMinuteIntervalsPassed > 0) {
                    cortisolLevel += fiveMinuteIntervalsPassed * CORTISOL_INCREASE_WORK;
                    endorphinLevel -= fiveMinuteIntervalsPassed * ENDORPHIN_DECREASE_WORK;
                    showAlertMessage(`‚è≥ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ —Ñ–æ–Ω–æ–≤–æ –≤—Ä–µ–º–µ: ${fiveMinuteIntervalsPassed * 5} –º–∏–Ω.`, 'text-yellow-600');
                }

                backgroundTimeStart = 0; // –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ –±—Ä–æ—è—á–∞
                updateHormoneUI();
                updateTimerUI();
            }
        }

        window.addEventListener('focus', () => {
            startTimer();
            applyBackgroundTime();
        });

        window.addEventListener('blur', () => {
            if (!isAlarmActive) {
                clearInterval(timerInterval);
                timerInterval = null;
                backgroundTimeStart = Date.now(); // –ó–∞–ø–æ—á–≤–∞–º–µ –æ—Ç–±—Ä–æ—è–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Ñ–æ–Ω–æ–≤–æ—Ç–æ –≤—Ä–µ–º–µ
            }
        });

        // –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        document.addEventListener('DOMContentLoaded', () => {
            rotateMottos();
            updateHormoneUI();
            updateTimerUI();
            startTimer(); // –ó–∞–ø–æ—á–≤–∞–º–µ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        });

    </script>
</body>
</html>
